<h1>Recipes List</h1>
<!--This table is intended to publish all recipes stored in recipes.json.
Recipes are created line by line via the fetch API using the createListItem() method. -->
<table id="recipes">
  <!--Tablehead is fix-->
  <tr>
    <th>Rezepttitel</th>
    <th>Zutaten</th>
    <th>Anweisungen</th>
  </tr>
</table>
<!--This form is used to create new Recipes. They get POST by fetch('recipes') and handled by server when submitting form-->
<form id="createRecipeForm">
  <p><input id="title" type="text" placeholder="Titel des Rezepts" required name="title"></p>
  <p><input type="text" placeholder="Welche Zutaten benötigen wir?" required name="ingredients"></p>
  <p><input type="text" placeholder="Welche Schritte müssen wir beim Nachkochen befolgen?" required name="instructions">
  </p>
  <p><input type="email" placeholder="Wie können wir dich für Rückfragen erreichen?" required name="mail"></p>
  <button type="submit">Create Recipe</button>
</form>

<script>
  const form = document.querySelector('#createRecipeForm');
  // This eventListener handles createRecipe-Inputs in form above
  form.addEventListener('submit', (event) => {
    event.preventDefault();

    const values = Object.fromEntries(new FormData(event.target));

    fetch('/recipes', {
      method: 'POST',
      headers: {
        'content-type': 'application/json'
      },
      body: JSON.stringify(values)
    }).then(res => {
      return res.json();
    }).then(recipe => {
      createListItem(recipe);
    });

  });

  // This function is used to insert a new recipe (which has already been POST into json)
  // in a new table row in table #recipes.
  // It automatically creates custom links for deletion and editing.
  function createListItem(recipe) {

    var table = document.getElementById("recipes");
    var row = table.insertRow();
    var cell1 = row.insertCell(0);
    var cell2 = row.insertCell(1);
    var cell3 = row.insertCell(2);
    var cell4 = row.insertCell(3);
    var cell5 = row.insertCell(4);
    cell1.innerHTML = recipe.title;
    cell2.innerHTML = recipe.ingredients;
    cell3.innerHTML = recipe.instructions;
    cell4.innerHTML = '<form id="delForm' + recipe.id + '" method="push" action="/recipes/' + recipe.id + '"><input type="submit" value="Löschen"></form>';
    cell5.innerHTML = '<form id="updForm' + recipe.id + '"method="push" action="/recipes/' + recipe.id + '"><input type="submit" value ="Bearbeiten"></form>';

    const delForm = document.querySelector('#delForm' + recipe.id);
    const updForm = document.querySelector('#updForm' + recipe.id);

    // This eventListener is used to delete a specific recipe
    // Activation takes place via the Delete button in the table row of the recipe to be deleted. 
    // The ID is assigned to the button accordingly. A new EventListener is created for each recipe. 
    delForm.addEventListener('submit', (event) => {
      event.preventDefault();
      fetch('/recipes/' + recipe.id, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        }
      }).then(() => {
        row.remove();
      }

      );
    });

    // This eventListener is used to insert the data of an existing recipe to be processed into the creation form in advance.
    // It GETs just the enquired recipe extracted from recipes.json 
    updForm.addEventListener('submit', (event) => {
      event.preventDefault();
      // this fetch GETs one single recipe
      fetch('/recipes/' + recipe.id)
        .then(res => {
          console.log(res);
          return res.json();
        }).then(recipe => {
          // insert recipe-data in form
          document.getElementById("title").value = recipe.title;
          document.getElementById("ingredients").setValue = recipe.ingredients;
          document.getElementById("instructions").setValue = recipe.instructions;
        });
    });
  }
// this is the standard GET-fetch-Method.
  fetch('/recipes').then(res => {
    return res.json();
  }).then(recipes => {
    recipes.forEach(recipe => {
      createListItem(recipe);
    });
  });

  // This method created by Franziska and Annika is not tested and implemented yet
  async function updateRecipe(recipe) {
    await fetch('/recipes/' + recipe.id, {
      methode: 'PUT',
      headers: {
        'content-type': 'application/json'
      },
      body: JSON.stringify(ticket)
    })
      .then(res => res.json())
      .then(tickets => {
        console.log(recipes)
      });
  }
</script>